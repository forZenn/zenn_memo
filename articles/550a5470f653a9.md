---
title: "cuiã§ã‚‚ãƒãƒƒãƒ†ãƒªãƒ¼ã‚’å¸¸ã«ç¢ºèªã—ãŸã„ã€‚"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Linux", "bash", "cui"]
published: true
---

cuiã‹ã¤noteãƒ‘ã‚½ã‚³ãƒ³ã§é–‹ç™ºã—ãŸã„ã¨ã„ã†äººã‚‚ãŸã¾ã«ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ã¯

1. ä½ã‚¹ãƒšãƒƒã‚¯pcã§ã‚‚ã¡ã‚ƒã‚“ã¨å‹•ã
2. htmlãªã©æç”»ã‚’é™¤ã‘ã°ã€vim,tmuxã§ã‚¬ãƒªã‚¬ãƒªæ›¸ã„ã¦ã‚‚å•é¡Œãªã„ã€‚
3. ãªã‚“ã‹å‡ºæ¥ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã£ã½ã„ã€‚

ãªã©ãã‚Œãªã‚Šã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚
ã§ã™ãŒã€cuiã®ã¨ãã«ç”»é¢ä¸Šã§é›»æºã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ãŒé™ã‚‰ã‚Œã‚‹ã®ã§ã€åŠã°å„„åŠ«ãªæ–¹ã‚‚ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
upower, acpiãªã©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã„ã¡ã„ã¡æ‰“ã£ã¦ã‚‰ã‚Œãªã„ã¨ã€‚
ãã®ãŸã‚ã®è§£æ±ºæ–¹æ³•ã‚’ã“ã“ã«æ›¸ãã¾ã™ã€‚

## ã‚„ã‚Šæ–¹

acpiã‚³ãƒãƒ³ãƒ‰ã€upowerã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€PS1ã«å……é›»æ®‹é‡ã®æ–‡å­—åˆ—ã‚’å…¥ã‚ŒãŸã‚‰ã„ã‘ãã†ã€‚

## ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡è¡¨ç¤ºé–¢æ•°

å……é›»æ®‹é‡ã®è¡¨ç¤ºã¯acpiã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¨upowerã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
osã‹ã‚‰ã™ã‚‹ã¨ãƒ¡ã‚¸ãƒ£ãƒ¼ãªæ–¹ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚
ä¸‹è¨˜ã®ã‚ˆã†ãªé–¢æ•°ã‚’è¨­å®šã™ã‚‹ã¨acpiã¨upowerã®å·®ã‚’å¸åã§ãã¾ã™ã€‚
ã“ã®é–¢æ•°ã‚’.bashrcãªã©ã§è‡ªå‹•ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```bash
function cui_battery_info {
  if command -v upower > /dev/null; then

    # ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡
    local percentage=$(
      upower -i /org/freedesktop/UPower/devices/battery_BAT0 | \
        grep "percentage:" | \
        rev | cut -d ' ' -f 1 | rev
    )
    local timeto
    local sentense=remaing
    timeto=$(
      upower -i /org/freedesktop/UPower/devices/battery_BAT0 | \
        grep "time to empty:" | \
        rev | cut -d ' ' -f 1-2 | rev
    )
    if [ -z "${timeto}" ]; then
      timeto=$(
        upower -i /org/freedesktop/UPower/devices/battery_BAT0 | \
          grep "time to full:" | \
          rev | cut -d ' ' -f 1-2 | rev
      )
      sentense=charging
    fi
    echo $timeto $sentense \($percentage\)
  elif command -v acpi > /dev/null; then

    local percentage=$(acpi | awk -F, '{print $2}' | sed 's/ //g')
    local timeto
    local sentense=remaing
    timeto=$(acpi | awk -F, '{print $3}' | cut -d ' ' -f 2)
    if acpi | grep Charging > /dev/null; then
      sentense=charging
    fi
    echo $timeto $sentense \($percentage\)
  else
    echo "acpi and upower command not found." >&2
    return 127
  fi
}
```

## PS1ã®å¤‰æ›´

~/.bashrcã«æ›¸ãã®ãŒä¸€èˆ¬çš„ã‹ã¨æ€ã„ã¾ã™ã€‚

grubå´ã§è¨­å®šãŒGUIã§ãªã„å ´åˆã‹ã€systemdã§GUIã§ãªã„å ´åˆã¯ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡ãŒ
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®$ã®å‰ã«é›»æ± æ®‹é‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```bash:~/.bashrc
# example write ~/.bashrc
systemd_unit=$(cat /proc/cmdline | xargs -n 1 | grep systemd.unit | cut -d '=' -f 2)
if [ "graphical.target" != "$(systemctl get-default)" ] || [ ! -z $systemd_unit ] && [ "graphical.target" != "$systemd_unit" ]; then
  if ! echo $PS1 | grep battery > /dev/null; then
   export PS1="(battery: \$(cui_battery_info))${PS1}"
  fi
fi
```

## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

æœ€æ–°ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚
[github](https://github.com/KatsutoshiOtogawa/shell_script/blob/main/bash/function/cui_battery_info)
