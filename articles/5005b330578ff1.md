---
title: "windowsã®ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["windows", "powershell"]
published: true
---

ç™ºè¡¨ç”¨ã®è‡ªåˆ†ç”¨èª¿æŸ»ãƒ¡ãƒ¢ã§ã™ã€‚
ã‚†ãˆã«é–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã‚ã‚Šã¾ã™ã€‚

## ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ä¸€è¦§

### powershell

```powershell

# å°‚ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§èª¿ã¹ã‚‹
# ã™ã¹ã¦ã®taskpathã‚’å†å¸°çš„ã«èª¿ã¹ã¦è¡¨ç¤ºã€‚
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§è¦‹ã‚‹ã“ã¨ãŒå¯èƒ½
Get-ScheduledTask

# ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã§è¦‹ã‚‹ã€‚
# Microsoftã¨ã‹Appleã¨ã‹ãƒ™ãƒ³ãƒ€ãƒ¼ã”ã¨ã«å‹æ‰‹ã«ãƒ‘ã‚¹ä½œã£ã¦ã„ã‚‹ã€‚
# rootæ¨©é™ã§ã—ã‹è¦‹ã‚Œãªã„ã€‚
Get-ChildItem "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks"

# ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã®å±¥æ­´ã®æœ‰åŠ¹ç„¡åŠ¹
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree"


# 
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks"
    -Name ENVNAME
    -Value "%VALUE%"
    -Type ExpandString

```

## ã‚¿ã‚¹ã‚¯ã®ç™»éŒ²

### powershellç”±æ¥

ã‚¿ã‚¹ã‚¯ã®ç™»éŒ²
```powershell
# 
$task=New-ScheduledTaskAction
    -Execute "msinfo32.exe"
    -Argument "/report C:\Report\msinfo.txt"
    -WorkingDirectory "C:\Report"

#
$trigger=New-ScheduledTaskTrigger
    -Weekly
    -DaysOfWeek Friday
    -At 5pm

$username=katsutoshi
# 
Register-ScheduledTask
    -TaskName "GenerateReport"
    -Trigger $trigger
    -Action $task
    -User $username
    -Taskpath "\api\"

```


## ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–

.net frameworkã¯powershell
dotnetã®pwshã«ã¯ãªã„ã€‚

ãªã®ã§ã€å»ƒæ­¢äºˆå®šã®ã‚„ã¤ã§ã—ã‹ä½¿ãˆãªã„ãœï¼

dotnetã®pwshã«å®Ÿè£…ã™ã‚‹ã¨ãã«ã©ã†ã„ã†å®Ÿè£…ã«ãªã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã‹ã‚‰ã€
ä»Šã‹ã‚‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰jobã§å®Ÿè£…ã™ã‚‹ã®ã¯è¾ã‚ãŸæ–¹ãŒè‰¯ã„ã€‚
6å¹´å‰powershellãŒOSSã«ãªã‚‹å‰ã«æ›¸ã„ã¦ã»ã¨ã‚“ã©ã»ã£ãŸã‚‰ã‹ã—ã€‚
æœ€å¾Œã«è§¦ã£ãŸã®3å¹´å‰ã¨ã‹ãã‚“ãªã‚‚ã‚“ã€‚

ã„ã¤å®Ÿè£…ã™ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã—ã€å»ƒæ­¢ã«ãªã£ã¦
å…¨ç„¶é•ã†æ©Ÿèƒ½ã«ãªã‚‹ã‹ã‚‚ã€‚

ä»Šå®Ÿè£…ã—ã¦ã‚‚ã€æ–°ã—ã„powershellã«ç§»è¡Œã™ã‚‹ã¨ãã«
å•é¡Œã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚

<!-- 
ã“ã®æ–°ã—ã„dotnetã¨.net frameworkã®powershellã¨ã®é•ã„ã£ã¦
æ—¥ã«æ—¥ã«ã©ã‚“ã©ã‚“å¤§ãããªã£ã¦ã„ã£ã¦ã„ã¦ã€
ä»Šã®æ‰€ã¯.net frameworkã§æ›¸ã„ãŸç‰©ã‚’dotnetã«ä»¥é™ã™ã‚‹ã¨ãã«
ã™ã”ãå¤§å¤‰ãªäº‹ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã£ã¦ã„ã‚‹ã€‚

MSã®powershellã®è²¬ä»»è€…ã¯OSã®ãƒãƒ¼ãƒ ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆã‚ãªã„ã¨ã„ã†
~~è¨€ã„è¨³~~ã‚’ã—ã¦ã„ã‚‹ãŒã€
powershellå˜ä½“ã§ã‚‚.net frameworkã«ã‚ã‚‹
æ©Ÿèƒ½ã™ã¹ã¦ã‚’ä½œã‚Œã¦ã„ãªã„ã®ã§ä»Šã®çŠ¶æ…‹ã§ã¯dotnetã®æ–¹ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹ã®ã¯å³ã—ã„ã€‚
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã‹ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¨ã‹
ã‚µãƒ¼ãƒãƒ¼ã«å¿…è¦ãªæ©Ÿèƒ½ã«é™ã£ã¦ãªã„...
-->

ã¤ã¾ã‚Šè©±ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ç¾æ™‚ç‚¹ã§MSå…¬å¼ãŒæä¾›ã—ã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã€ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã§
å°å…¥ã—ãŸçµæœã€å®‰å¿ƒã—ã¦å¹´ã‚¹ãƒ‘ãƒ³ã§é‹ç”¨ç§»è¡Œã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç«‹ã¦ã‚Œã‚‹ã‚‚ã®ã¯å­˜åœ¨ã—ãªã„ã€‚

ã•ã™ãŒä¿ºãŸã¡ã®MSã ãœï¼

<!-- 
ãŠå®¢ã•ã‚“ãŒå–œã¶ã‚µãƒ¼ãƒ“ã‚¹ã‚„ç‰©ã‚’ä½œã£ã¦ãŠé‡‘ã‚’ã‚‚ã‚‰ã£ã¦ã„ã‚‹ã®ã«ã€
windowsã§ã‚µãƒ¼ãƒ“ã‚¹ã‚„ç‰©ã‚’ä½œã‚‹äº‹ãŒç›®çš„ã«ãªã£ã¦ã—ã¾ã†ã€‚


-->

## äº‰ç‚¹
ç”¨é€”ã¨ã—ã¦ã¯ã‚µãƒ¼ãƒãƒ¼ç”¨ã¨ã‚ˆã‚Šã‚‚ã€
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ã„ãŸã‚‰ã€ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‹ãã†ã„ã†ä½¿ã„æ–¹ã€‚

Visual studioã‚’é–‹ã„ãŸã¨ãã«taskå®Ÿè¡Œã—ã¦ã€ã ã£ãŸã‚‰ã€
updateä¿ƒã™ã€‚

MSã®ã‚¢ãƒ—ãƒªã§ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ï¼Ÿ


1. systemdã¿ãŸããƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§ç™»éŒ²ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§å®Ÿè¡Œã¯ã§ããªã„ã€‚

2. ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰è§¦ã£ã¦ç›´æ¥å¤‰æ›´ã™ã‚‹ãªã‚‰powershellç”±æ¥ã§ã•ãˆç®¡ç†è€…æ¨©é™å¿…é ˆã€‚

3. å°‚ç”¨ã‚³ãƒãƒ³ãƒ‰ãªã‚‰ç®¡ç†è€…æ¨©é™ã„ã‚‰ãªã„ã€‚
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ãªã‚‰HKLMã§ãªãã¦ã€HKCUã«ã„ã‚Œã‚‹ã¹ãã§ã‚ã£ã¦è¨­è¨ˆãƒŸã‚¹ã®å¯èƒ½æ€§ãŒé«˜ã„ã€‚
5. systemdã¨taskchedulerã®é•ã„è¡¨ãŒã„ã‚‹ã€‚

| ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« | ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
| ---------------- | -------------------- | ------------------- |
| systemd          | /home/username/systemd              | /lib/systemd |
| cron             | /var/spool/cron                                                                | /etc/cron*  |
| task scheduler   | HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks | åŒå·¦ |

6. anacronã«è¿‘ã„ã€‚èµ·å‹•æ™‚ã«éãã¦ãŸã‚‰ã€å®Ÿè¡Œã€‚
7. è‡ªåˆ†ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„æ™‚ã«å®Ÿè¡Œãªã‚‰Credentialå¿…è¦ã€‚

1. powwershellã¨taskchedulerãŒç›¸æ€§ãŒæ‚ªã„ã€‚

ç›´æ¥powershellã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¦ãªã„ã€‚

ã‚„ã‚ŠãŸã„ãªã‚‰
pwsh.exe 
    -File 
    -WorkingDirectory 
    -NonInteractive 

1. registerã§ç™»éŒ²ã™ã‚‹ã®ã‹ã€New-ScheduledTaskã§è¨­å®šã™ã‚‹ã®ã‹
ã¯ã£ãã‚Šã—ãªã„...settingsã—ã‹ã‚Šã€principalã—ã‹ã‚Š...ã“ã®ã›ã„ã§taskãŒä½œã‚‰ã‚Œã‚‹ã€‚
2. Authorã‚„Descriptionã‚’å¼·åˆ¶ã—ã¦ã„ãªã„
3. ãªãœã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒVistaã®è¨­å®š...
4. æ™‚é–“ã‚’æŒ‡å®šã—ãŸã‚‰ã€ç™»éŒ²ã§ããªã„...ãƒã‚°è‡­ã„ã€‚
5. Logonã‚’æŒ‡å®šã—ãªã„ã€‚

parametersetã«ç¿»å¼„ã•ã‚Œã‚‹...


Office ClickToRun Service Monitor


```powershell
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§ç™»éŒ²ã§ãã‚‹ã€‚
# ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œè€…ã®ã‚¸ãƒ§ãƒ–ã¯å®šç¾©ã§ããªã„ã€‚
# 
# defaultã®è¨­å®šã ã¨Vistaã¨Windows Server 2008ã®è¨­å®šã§ä½œã‚‰ã‚Œã‚‹
$action=New-ScheduledTaskAction `
    -Execute "pwsh.exe" `
    -Argument "-File ${HOME}\pwsh\hello.ps1 -WorkingDirectory ${HOME}\pwsh\ -NonInteractive" `
    -WorkingDirectory "${HOME}\pwsh\"

# å®šæœŸå®Ÿè¡Œã‚’æŒ‡å®šã—ãŸã‚‰ã€ãªãœã‹ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã§ãã‚‹ã‹ã©ã†ã‹æŒ‡å®šãŒã§ããªã„ã€‚
$trigger=New-ScheduledTaskTrigger `
    -Weekly `
    -DaysOfWeek Friday `
    -At 5pm
    # -Logon
# powershellå®Ÿè¡Œè€…=ç™»éŒ²è€…è‡ªèº«ã®å ´åˆ
$username="$($Env:computername)\$($env:username)"
# ç·¨é›†ã™ã‚‹ã¨ãã«æ¯å›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã„ã‚‹...ãªã‚“ã§ã“ã‚“ãªä½œã‚Šã«ã—ãŸ...
$password = ""
$taskname = "Hello"

# batteryã®çŠ¶æ…‹ã¨ã‹ã€ä½•åˆ†ãŸã£ã¦çµ‚ã‚ã‚‰ãªã‹ã£ãŸã‚‰ä¸­æ­¢ã¨ã‹ã€‚
# compatibility
# Win8ã£ã¦æ›¸ãã‘ã©GUIä¸Šã§ã¯Win10ã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
$settings = New-ScheduledTaskSettingsSet `
    -Compatibility Win8 `
    -WakeToRun
$task = New-ScheduledTask `
    -Description "ã‚ˆã†ã‚„ãã‚’ã“ã“ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚" `
    -Action $action `
    -Trigger $trigger `
    -Settings $settings

# authorã®åå‰ã‚‚è¨­å®šã™ã‚‹ã€‚
$task.Author = "otowakka"

# versionã®è¨­å®š
$task.Version = "16.0.0"

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ—¥ã§ãªãã¦ãƒªãƒªãƒ¼ã‚¹æ—¥
# ã¾ã•ã‹ã®dateã˜ã‚ƒãªãã¦ã‚‚å…¥ã‚Œã‚Œã‚‹ã€‚
# 2017-01-01T00:00:00 ã¿ãŸã„ãªå½¢å¼ãŒå¦¥å½“
$task.Date = "2022-01-01T00:00:00"

# Userã¨passwordãŒã‚ã£ãŸã‚‰æš—é»™çš„ã«ãƒ­ã‚°ã‚¤ãƒ³
# Useråã ã‘ã ã£ãŸã‚‰ã€ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿ã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚
Register-ScheduledTask `
    $task `
    -TaskName $taskname `
    -User $username `
    -Password $password `
    -Taskpath "\api\" 

```

```powershell
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§ç™»éŒ²ã§ãã‚‹ã€‚
# ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œè€…ã®ã‚¸ãƒ§ãƒ–ã¯å®šç¾©ã§ããªã„ã€‚
# 
# defaultã®è¨­å®šã ã¨Vistaã¨Windows Server 2008ã®è¨­å®šã§ä½œã‚‰ã‚Œã‚‹
$action=New-ScheduledTaskAction `
    -Execute "pwsh.exe" `
    -Argument "-File -WorkingDirectory -NonInteractive" `
    -WorkingDirectory "C:\Report"

# å®šæœŸå®Ÿè¡Œã‚’æŒ‡å®šã—ãŸã‚‰ã€ãªãœã‹ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã§ãã‚‹ã‹ã©ã†ã‹æŒ‡å®šãŒã§ããªã„ã€‚
$trigger=New-ScheduledTaskTrigger `
    -Weekly `
    -DaysOfWeek Friday `
    -At 5pm
# powershellå®Ÿè¡Œè€…=ç™»éŒ²è€…è‡ªèº«ã®å ´åˆ
$username="$($Env:computername)\$($env:username)"

# ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚å®Ÿè¡Œã™ã‚‹ã®ã¯ServiceAccount
$principal=New-ScheduledTaskPrincipal `
    -UserId $username `
    -RunLevel Highest

    
# batteryã®çŠ¶æ…‹ã¨ã‹ã€ä½•åˆ†ãŸã£ã¦çµ‚ã‚ã‚‰ãªã‹ã£ãŸã‚‰ä¸­æ­¢ã¨ã‹ã€‚
# compatibility
# Win8ã£ã¦æ›¸ãã‘ã©GUIä¸Šã§ã¯Win10ã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
$settings = New-ScheduledTaskSettingsSet `
    -Compatibility Win8
$task = New-ScheduledTask `
    -Description "ã‚ˆã†ã‚„ãã‚’ã“ã“ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚" `
    -Action $action `
    -Trigger $trigger `
    -Settings $settings

# authorã®åå‰ã‚‚è¨­å®šã™ã‚‹ã€‚
$task.Author = "otowakka"

# versionã®è¨­å®š
$task.Version = "16.0.0"

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ—¥ã§ãªãã¦ãƒªãƒªãƒ¼ã‚¹æ—¥
# ã¾ã•ã‹ã®dateã˜ã‚ƒãªãã¦ã‚‚å…¥ã‚Œã‚Œã‚‹ã€‚
# 2017-01-01T00:00:00 ã¿ãŸã„ãªå½¢å¼ãŒå¦¥å½“
# Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ãªã„ã¨ãƒ€ãƒ¡ã ãŒã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã€‚
$task.Date = "2022-01-01T00:00:00"

Register-ScheduledTask `
    $task `
    -TaskName "GenerateReport" `
    -Taskpath "\api\" 

```


```powershell
# ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã‹ã€
$action=New-ScheduledTaskAction `
    -Execute "pwsh.exe" `
    -Argument "-File -WorkingDirectory -NonInteractive" `
    -WorkingDirectory "C:\Report"

#
$trigger=New-ScheduledTaskTrigger `
    -AtLogon:$false `
    -Weekly `
    -DaysOfWeek Friday `
    -At 5pm

# powershellå®Ÿè¡Œè€…=ç™»éŒ²è€…ä»¥å¤–ã®å ´åˆã€‚
$username=$env:username

$principal=New-ScheduledTaskPrincipal `
    -UserId $username `
    -LogonType Password

$task = New-ScheduledTask `
    -Trigger $trigger `
    -Principal $principal `
    -Action $action 

# ã“ã†ã™ã‚‹ã€‚
$task.Auhtor = "otowakka"

Register-ScheduledTask `
    $task `
    -TaskName "GenerateReport" `
    -Taskpath "\api\"
```

```powershell
# é€šçŸ¥ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Install-Module -Name BurntToast -RequiredVersion 0.8.5


Import-Module BurntToast

# çµ‚äº†é€šçŸ¥ã¨ã‹ã€‚
$title = "Don't forget to smile!"
$text = 'Your script ran successfully, celebrate!'

# Powershellç”±æ¥ã®ã¨ã„ã†é¢¨ã«æ›¸ã‹ã‚Œã‚‹ã€‚
New-BurntToastNotification -AppLogo "${HOME}\Pictures\6dc77b22caee44416a169a3a31ef6392.jpg" -Text $title, $text
```

```powershell

# userä¸€è¦§ã€‚
# get-WmiObjectã¯éæ¨å¥¨ã€‚
# ADUserä»¥å¤–ã€‚
# windowsã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ã™ã‚‹ã¨ãã¯hoståä»˜ãã§ç™»éŒ²ã—ãªã„ã¨
# å‹•ã‹ãªã„æ™‚ãŒã‚ã‚‹ã€‚taskschedulerã¨ã‹ã€‚
Get-LocalUser |
    Foreach-Object {$_.Name = "$($Env:ComputerName)\$($_.Name)"; $_} |
    Select-Object Name

$password=ConvertTo-SecureString "password" -AsPlainText -Force
# userä½œæˆ
New-LocalUser -Name Hello -Password $password

Start-Process -FilePath 'pwsh.exe' -Credential 'Hello'

# 
$userinstance = Get-LocalUser -Name "selectname" |
    Select-Object -Expandproperty Name
if ($userinstance -eq $null) {
    return 1;
}
```

```powershell
Microsoft-Windows-TaskScheduler/Maintenance

# å®Ÿè¡Œ
wevtutil set-log Microsoft-Windows-TaskScheduler/Operational /enabled:true
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«ãƒ­ã‚°å–ã‚‹ã¨ã‹
ãã‚“ãªè€ƒãˆã‚‰ã‚ŒãŸä½œã‚Šã«ãªã£ã¦ã„ãªã„ã€‚

```powershell
# æœ€å¾Œã®ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ãŸã‹ã©ã†ã‹ã®ç¢ºèª
Get-ScheduledTaskInfo

# ãƒ­ã‚°ã‚’è¦‹ã‚‹ã€‚
# Get-EventLogã¯éæ¨å¥¨ã€‚

Get-Scheduled

$FulltaskPath=Join-Path "\api" -ChildPath "Hello"

# -eqã§æ¯”è¼ƒã§ããªã„ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ¢ã™ã“ã¨ã«ãªã‚‹ã®ã§ã€‚
Get-WinEvent `
    -LogName Microsoft-Windows-TaskScheduler/Operational |
    ?{ $_.Message -match $FullTaskPath}


# ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚¨ã‚­ã‚¹ãƒãƒ¼ãƒˆã—ãŸã„ã€‚
# å¾Œã§ãƒ­ãƒ¼ã‚«ãƒ«ã§è¦‹ãŸã„ã‹ã‚‰ã€‚
Get-WinEvent `
    -LogName Microsoft-Windows-TaskScheduler/Operational |
    ?{ $_.Message -match $FullTaskPath} |
    Export-CliXml -Path event.xml

# ãƒ­ã‚°ãŒè¦‹ã‚Œã‚‹ã€‚
Import-CliXml -path event.xml

```


```powershell
Get-ScheduledTask
```

ã¨ã„ã†é¢¨ã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ã«ç™»éŒ²ã™ã‚‹å ´åˆã¯



ãŸã è¤‡é›‘ã«ãªã£ã¦ã‚‚ã€

Get-Disk

ãã®ä»£ã‚ã‚Šã¨ã„ã£ã¦ã¯ãªã‚“ã ãŒã€scheduled jobã¨ã„ã†ç‰©ãŒã‚ã‚‹ã€‚


## Powershellã‹ã‚‰pwshå‘¼ã¶
.net frameworkã®Powershellã‹ã‚‰
dotnet ã®Powershellã‚’ç™»éŒ²ã™ã‚‹

ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨jobã®ç™»éŒ²ã¨ã„ã†ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚°å–ã‚‹ã‚„ã¤ã ã—ã€‚


```powershell
# Windows11ã ã¨ç®¡ç†è€…æ¨©é™ãŒã„ã‚‹ã€‚
# ãƒã‚°ã®æ°—ã‚‚ã™ã‚‹ã€‚
# registryè§¦ã‚Šã«è¨€ã£ã¦ã„ã‚‹ã‘ã©ã€ã„ã¤ã®ã¾ã«ã‹è§¦ã‚Œãªããªã£ãŸç³»ã‹ã€‚

# ä¿å­˜å…ˆ
Get-ChildItem $env:USERPROFILE\AppData\Local\Microsoft\Windows\PowerShell\ScheduledJobs

# å®šæœŸå®Ÿè¡Œã‚’æŒ‡å®šã—ãŸã‚‰ã€ãªãœã‹ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã§ãã‚‹ã‹ã©ã†ã‹æŒ‡å®šãŒã§ããªã„ã€‚
$trigger=New-JobTrigger `
    -Weekly `
    -DaysOfWeek Friday `
    -At 5pm
    # -Logon

$trigger = New-JobTrigger `
    -User $username`
    -AtLogon

$option = New-ScheduledJobOption -WakeToRun
$taskname = "Hello"

# powershellå®Ÿè¡Œè€…=ç™»éŒ²è€…è‡ªèº«ã®å ´åˆ
$username="$($Env:computername)\$($env:username)"
$cred = Get-Credential -UserName $username

# Workingdirectoryã‚‚ä¸ãˆã‚‰ã‚Œãªã„
# å‰²ã¨ã‚ã„ã¾ã„ã«ãªã‚‹ã€‚
Register-ScheduledJob `
    -Name $taskname `
    -FilePath "${HOME}\pwsh\hello_dummy.ps1" `
    -ArgumentList $null `
    -ScheduledJobOption $option `
    -Trigger $trigger

# ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«æ›¸ãã€‚
# pwsh.exe -File "${HOME}\pwsh\hello.ps1" -WorkingDirectory "${HOME}\pwsh\" -NonInteractive

ãªãœã‹ç™»éŒ²ã§ããªã„...

# scheduled Jobã§ã‚‚çµå±€scheduled taskã§ç™»éŒ²ã•ã‚Œã‚‹ã€‚
# taskpath \Microsoft\Windows\Powershell\ScheduledJobs\
# Name

# vistaã§ç™»éŒ²ã•ã‚Œã‚‹ã€‚

ã“ã‚ŒãŒVista, Windows Server 2008ã§ç™»éŒ²ã•ã‚ŒãŸã‚‰ã€ScheduledTaskãŒã¡ã‚ƒã‚“ã¨å‹•ãã‹ã©ã†ã‹
ã‚ã‹ã‚‰ãªã„ã€‚
windows11ã§çµæ§‹ãŒã‚ŠãŒã‚Šå¤‰ã‚ã£ã¦ã„ã‚‹ã®ã«ã€‚
vistaã®é ƒã¯ç®¡ç†è€…æ¨©é™ãŒã„ã‚‰ãªã‹ã£ãŸã®ã‹ã‚‚ã€‚

ãšã£ã¨æ”¾ç½®ã•ã‚Œã¦ã„ã‚‹...

ä½™è«‡ã ãŒã€æ–°ã—ã„pwshã§ã¾ã ä½œã‚‰ã‚Œã¦ã„ãªã„ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã£ã¦ã€
Vistaã‚„ï¼—ã®é ƒã®æ©Ÿèƒ½ãŒå¤šãã¦ã€ä»Šã‚‚ã¡ã‚ƒã‚“ã¨å‹•ãã®ã‹ä¿å®ˆã•ã‚Œã¦ã„ã‚‹ã®ã‹è¬ãªã‚„ã¤ãŒå¤šã„ã€‚
ã¾ã‚ã€ç¾æ®µéšã§ã¯å¤ã„powershellã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’æ‰“ã¡ã«è¡Œãã¨ã„ã†å¤ã„ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã„ã†ä½œã‚Šã§
ã¨ã‚Šã‚ãˆãšä½œã£ã¦ã€windows11ã ã¨ã“ã†ã„ã†ç†ç”±ã§å‹•ãã¾ã›ã‚“ã§ã—ãŸã£ã¦ç†ç”±ãŒã‚ã‹ã£ãŸã‚‰ã€
ãã‚Œã‚’å‚è€ƒã«æ›¸ãæ›ãˆã‚‹ã§ã„ã„æ°—ãŒã™ã‚‹ãŒã€‚
ä»Šã‚‚ã€å¤ã„Powershellã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰ã€
ã„ãšã‚Œã«ã›ã‚ˆå‡¦ç†å£Šã‚Œã¦ã„ã‚‹ãªã‚‰å¤ã„ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ–¹ã‚’éæ¨å¥¨ã«ã—ã¦
æ–°ãŸã«ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆä½œã£ãŸã‚‰è‰¯ã„ã—ã€‚
ã‚³ãƒãƒ³ãƒ‰ã†ã¡ã«ã„ãã ã‘ã ã‹ã‚‰ã€åˆ¥ã«å‡¦ç†é…ããªã‚‰ã‚“ã—...

æœ€çµ‚çš„ã«æ–°ã—ã„Powershellã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦ãã ã•ã„ã§è‰¯ã„ã¯ãšã€‚

```
