---
title: "rhelç³»OSã®bootstrap"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Linux', 'Fedora', 'ArchLinux', 'bash']
published: true
---

debianç³»ã«ã¯debootstrap,arcnç³»ã¯arch-bootstrapã§ã€
bootstrap(æœ€å°é™ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„chrootç’°å¢ƒç”¨ã®åˆæœŸåŒ–å‡¦ç†)ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚

rhelç³»OSã«ã¯ã“ã‚Œã‚‰ã¨=ã®ã‚‚ã®ã¯ãªã„ãŒã€dnfã‚³ãƒãƒ³ãƒ‰ã§bootstrapä½œæ¥­ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚

dnfã‚³ãƒãƒ³ãƒ‰ã¯rhelç³»OSã§ã¯æœ€åˆã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€ãã®ä»–archlinux,manjarolinuxã§ã¯
Community repositoryã«ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹ã®ã§ã€ãã‚Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚

ä¾‹ã¨ã—ã¦ã€chrootç’°å¢ƒã«å¯¾ã™ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ã“ã“ã«æ›¸ãã¾ã™ã€‚
æœ€å°é™ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ãŸã„ã¨ãã‚„ã€ãƒ›ã‚¹ãƒˆå´ã®ã‚¹ãƒšãƒƒã‚¯ãŒè²§å¼±ãªã¨ãã®ä»®æƒ³ç’°å¢ƒã¨ã—ã¦ã€
è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

## å‰æ

ãƒ›ã‚¹ãƒˆå´ãŒdnfã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹OSã§ã‚ã‚‹ã“ã¨ã€‚
æœ€è¿‘ã§ã¯rhelç³»ä»¥å¤–ã®Debianç³»ã€archç³»ã€Gentooã§ã‚‚
ç‰¹ã«ä½•ã‚‚ã—ãªãã¦ã‚‚OSæ¨™æº–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚

rhelç³»ä»¥å¤–ã¯dnfã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã€
/etc/yum.repos.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã„ãªã„ã®ã§ã€
æ‰‹å‹•ã§ä½œæˆã™ã‚‹ã“ã¨ã€‚

## ä¸‹æº–å‚™

ä»¥ä¸‹ã®æ§‹æˆã«ã—ã¦ãŠãã“ã¨ã€‚

### ã‚²ã‚¹ãƒˆå´ã®æº–å‚™

ã‚ã‚‰ã‹ã˜ã‚ä¸‹ã®ã‚ˆã†ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ†ã‘ã¦ãŠãã€
ãã“ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚

#### chrootã‚’ä½¿ã†å ´åˆ

```bash
# ä»®æƒ³ç’°å¢ƒç”¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ãŠãã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
mkfs.ext4 /dev/sdxn
# ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚¦ãƒ³ãƒˆã€‚ã“ã“ã«dnfã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
mount /dev/sdxn /mnt/fedora
```

#### systemd-nspawnã‚’ä½¿ã†å ´åˆ

```bash
# debianç³»
sudo apt install -y systemd-container
```

ä»®æƒ³ç’°å¢ƒç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ

```bash
sudo mkdir /var/lib/machines/fedora
```

### ãƒ¬ãƒã‚¸ãƒˆãƒªã®è¨­å®š

ãƒ›ã‚¹ãƒˆå´ã®OSãŒmanjaro,archlinuxã®å ´åˆã¯dnfã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã ã‘ã§ã¯ã€dnfã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆãªã„ã®ã§ä¸‹è¨˜ã®è¨­å®šã‚’ã—ã¦ãŠãã“ã¨ã€‚

fedoraã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã€‚

```bash:/etc/yum.repos.d/fedora.repo
[fedora]
name=Fedora Server $releasever - Base
baseurl=http://ftp.riken.jp/pub/Linux/fedora/releases/$releasever/Server/$basearch/os
gpgkey=https://getfedora.org/static/fedora.gpg
```

centos-streamã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆ

```bash:/etc/yum.repos.d/centos.repo
[centos]
name=CentOS-stream $releasever - Base
baseurl=http://ftp.riken.jp/pub/Linux/centos/$releasever-stream/BaseOS/$basearch/os
gpgkey=http://ftp.riken.jp/pub/Linux/centos/RPM-GPG-KEY-CentOS-Official
```

oracle-linuxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆ

```bash:/etc/yum.repos.d/oracle_linux.repo
[oracle_linux]
name=oracle_linux $releasever - Base
baseurl=https://yum.oracle.com/repo/OracleLinux/OL$releasever/baseos/latest/$basearch/
gpgkey=https://yum.oracle.com/RPM-GPG-KEY-oracle-ol$releasever
```

## ä½¿ã„æ–¹

ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

fedoraã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã€‚

```bash
ARCH=amd64
version=35
# repoã«yum.repoã«è¨­å®šã—ãŸãƒ¬ãƒã‚¸ãƒˆãƒªåï¼ˆä¾‹[fedora]ï¼‰ã‚’ä½¿ã†ã€‚
dnf install --installroot=/mnt/fedora --repo fedora --releasever=$version fedora-release-server systemd dnf
```

centos-streamã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆ

```bash
ARCH=amd64
version=8
# repoã«yum.repoã«è¨­å®šã—ãŸãƒ¬ãƒã‚¸ãƒˆãƒªåï¼ˆä¾‹[centos]ï¼‰ã‚’ä½¿ã†ã€‚
dnf install --installroot=/mnt/centos --repo=centos --releasever=$version centos-stream-release systemd dnf 
```

oracle-linuxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆ

```bash
ARCH=x86_64
version=8
# repoã«yum.repoã«è¨­å®šã—ãŸãƒ¬ãƒã‚¸ãƒˆãƒªåï¼ˆä¾‹[oracle_linux]ï¼‰ã‚’ä½¿ã†ã€‚
## oracle linux 7,8ã®å ´åˆ
dnf install --installroot=/mnt/oracle_linux --repo=oracle_linux --releasever=$version oracle-release-el${version} systemd dnf

## oracle linux 9ã®å ´åˆã€‚coreãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒå¤‰æ›´ã«ãªã£ãŸã®ã§ã€å¤‰æ›´ã€‚
dnf install --installroot=/mnt/oracle_linux --repo=oracle_linux --releasever=$version oraclelinux-release-el${version} systemd dnf
```

ã‚ã¨ã¯chrootã‹ã€systemd-nspawnã§ãã‚Œãã‚Œã®ç’°å¢ƒã«å…¥ã‚Šã€Linux imageã‚„firmwareã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚Šã€osã®è¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
