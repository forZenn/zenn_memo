---
title: "Pwshã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Powershell", "Windows", "dotnet"]
published: true
published_at: 2022-09-08 19:00 
---

Windowsç’°å¢ƒã«ãŠã‘ã‚‹dotnet Pwshã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚
å…¬å¼ã§ã¯åˆ†ã‹ã‚Šã¥ã‚‰ã„ã€èª¬æ˜ä¸è¶³æ°—å‘³ãªã®ã§ã€‚

## æº–å‚™

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®clone

```powershell
# forkã—ã¦ã‚‹ãªã‚‰ãƒ•ã‚©ãƒ¼ã‚¯å…ƒ
gh repo clone Powershell/Powershell
```

### é©å½“ãªã‚¿ã‚°ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ

ã¨ã‚Šã‚ãˆãšã€æ­£ã—ã„å‹•ä½œã‚’å…ˆã«è¦‹ã¾ã—ã‚‡ã†ã€‚
rec2ã¯å¤§ä½“å‹•ãã¾ã™ã€‚previewã¯æ€ªã—ã„ã€‚
ã¶ã£ã¡ã‚ƒã‘å‹•ä½œç¢ºèªã™ã‚‹ã ã‘ãªã‚‰ã€previewã˜ã‚ƒãªãã¦ã€rcè¦‹ã¾ã—ã‚‡ã†ã€‚
ãã‚ŒãŒç„¡ã„ãªã‚‰ã€ãƒªãƒªãƒ¼ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä½¿ã„ã¾ã—ã‚‡ã†ã€‚
é¢å€’ãã•ã„ã“ã¨è€ƒãˆãªãã¦ã™ã¿ã¾ã™ã€‚

```bash
# ã‚¿ã‚°ä¸€è¦§
git tag

git checkout v7.3.6
```

### IDE or editor

Powershell.slnã¨Visual studioç”¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãŒã€
Visual studioã¯åˆ¥ã«ãªãã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã¯ã§ãã‚‹ã€‚

Visual studioã¨vscodeã¨æ…£ã‚Œã¦ã„ã‚‹ã»ã†ã§ã‚ˆã„ã€‚

ãŸã ã€ãƒ†ã‚¹ãƒˆã§ã‹ãªã‚Šé‡ã„å‡¦ç†ã«ãªã‚‹ã®ã§vscodeã®æ–¹ãŒã„ã„ã‹ãªï¼Ÿ

### ç’°å¢ƒæ§‹ç¯‰

#### windows

##### dotnet sdk

ãƒ“ãƒ«ãƒ‰ã«previewç‰ˆã®dotnet sdkãŒã„ã‚‹ã€‚
Start-PSBootstrapã§ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ãŒã€
ã“ã‚Œã«ãƒã‚°ãŒã‚ã‚‹ã‚‰ã—ãã€Start-PSBootstrapçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨
"C:\Program Files\dotnet\packs\Microsoft.NETCore.App.Ref\7.0.0-preview.7.22375.6"
ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã™ã‚‹ã€‚
winget çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```powershell
winget install Microsoft.DotNet.SDK.Preview
```

##### dotnetã® powershell

æœ€æ–°ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãªã„ï¼‰ã®dotnet ã®powershellã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```powershell
winget install Microsoft.PowerShell
```

##### ä¾å­˜ã—ã¦ã„ã‚‹Powershellã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æŒ‡å®šã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’nugetã®global-packagesã«ç½®ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
nugetã§ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ã®ã§ã€
powershellã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã«nugetã®global-packagesã«ãƒ‘ã‚¹ã‚’é€šã™å½¢ã§ã€
å‡¦ç†ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã™ã¹ã¦dotnetã®powershellã§è¡Œã£ã¦ãã ã•ã„ã€‚

###### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ç®¡ç†è€…æ¨©é™ã§è¡Œã£ã¦ãã ã•ã„ã€‚

```powershell
# module ä¸‹è¨˜ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã™ã¹ã¦PSGalleryçµŒç”±ã®ãŸã‚ã€PSGalleryã‚’ä¿¡ç”¨ã§ãã‚‹ã¨ã—ã¦ãŠãã€‚
Set-PSRepository -Name PSGallery -InstallationPolicy Trusted

# æŒ‡å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
# å¿…è¦ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã£ãŸå ´åˆã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«å¤±æ•—ã™ã‚‹ã®ã§ãã®æ™‚ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚
Install-Module -Name PowerShellGet -RequiredVersion 2.2.5 -Force
Install-Module -Name PackageManagement -RequiredVersion 1.4.8.1 -Force
Install-Module -Name Microsoft.Powershell.Archive -RequiredVersion 1.2.5 -Force
Install-Module -Name PSReadLine -RequiredVersion 2.2.6 -Force
Install-Module -Name ThreadJob -RequiredVersion 2.0.3 -Force
```

###### ãƒ‘ã‚¹ã‚’é€šã™

yournameã¯ä½¿ã£ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«ç½®ãæ›ãˆã‚‹ã“ã¨ã€‚

```powershell
New-item -type SymbolicLink -Value "C:\Users\yourname\Documents\PowerShell\Modules\PowerShellGet" -Path "C:\Users\yourname\.nuget\packages\PowershellGet"

New-item -type SymbolicLink -Value "C:\Users\yourname\Documents\PowerShell\Modules\PackageManagement" -Path "C:\Users\yourname\.nuget\packages\PackageManagement"

New-item -type SymbolicLink -Value "C:\Users\yourname\Documents\PowerShell\Modules\Microsoft.PowerShell.Archive" -Path "C:\Users\yourname\.nuget\packages\Microsoft.PowerShell.Archive"
New-item -type SymbolicLink -Value "C:\Users\yourname\Documents\PowerShell\Modules\PSReadLine" -Path "C:\Users\yourname\.nuget\packages\PSReadLine"
New-item -type SymbolicLink -Value "C:\Users\yourname\Documents\PowerShell\Modules\ThreadJob" -Path "C:\Users\yourname\.nuget\packages\ThreadJob"
```

###### ãƒ“ãƒ«ãƒ‰

```bash
Import-Module ./build.ps1

# build
Start-PSBuild
```

#### docker

windowsã‚ˆã‚Šã€ã“ã£ã¡ã®æ–¹ãŒç°¡å˜ã§ã™ã€‚

```powershell
Import-Module ./build.ps1

# powershellã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚„ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¼¼åˆã£ãŸå¦¥å½“ãªdotnet ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã¨ã£ã¦ãã‚‹ã€‚
Start-PSBootstrap

## ãƒ“ãƒ«ãƒ‰
Start-PSBuild
```


ãƒ“ãƒ«ãƒ‰å…ˆã¯
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå\src\powershell-win-core\bin\Debug\net7.0\win7-x64\publish\pwsh.exe
ã¨ãªã£ã¦ã„ã‚‹ã€‚

## resource generator

resxãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã€ä¿®æ­£ã—ãŸå ´åˆã¯ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¦
csãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```powershell
Start-PSBuild -ResGen
```

## è©¦ã—ã«ä½¿ã£ã¦ã¿ã‚‹

```powershell
# shell ã«ãƒ­ã‚°ã‚¤ãƒ³
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå\src\powershell-win-core\bin\Debug\net7.0\win7-x64\publish\pwsh.exe

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦‹ã‚‹ã¨ç¢ºã‹ã«ä»Šãƒ“ãƒ«ãƒ‰ã—ãŸã‚„ã¤ã«ãªã£ã¦ã„ã‚‹ã¯ãšã€‚
echo $PSVersiontable
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```powershell

# å…¨ãƒ†ã‚¹ãƒˆ
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ãŸãã•ã‚“poweshellã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã„ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚
# ã‹ãªã‚Šãƒ¡ãƒ¢ãƒªé£Ÿã†ã®ã§æ³¨æ„ã€‚
Start-PSPester


# ä¸€éƒ¨ã®ã¿ãƒ†ã‚¹ãƒˆ
# ãŸã„ã¦ã„ã“ã£ã¡ã®ã»ã†ã‚’ä½¿ã†ã¨æ€ã†ã€‚
# æ›¸ã„ãŸãƒ†ã‚¹ãƒˆã¸ã®ãƒ‘ã‚¹ã‚’æ›¸ãã€‚
Start-PSPester -Path .\test\powershell\Modules\Microsoft.PowerShell.Management\Set-Location.Tests.ps1
```

## å‚è€ƒ

[Windows Buildæ–¹æ³•](https://github.com/PowerShell/PowerShell/blob/master/docs/building/windows-core.md)

## ã¾ã¨ã‚

é¢å€’è‡­ã„...
windowsãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ã¾ã‚Šdotnetã®shellä½¿ã£ã¦ç„¡ã„ã‚“ã˜ã‚ƒãªã„ã‹ãª...?

ãªã®ã§ã€.Net Frameworkã®powershellé–‹ãã¨dotnetã®powershell
ç´¹ä»‹ã™ã‚‹ã¨ã„ã†æ„Ÿã˜ãªæ°—ãŒã™ã‚‹ã€‚

windowsã«ã¯Start-PSBootstrapãªã‚“ã¦ã‚‚ã®ã¯ç„¡ã‹ã£ãŸã€‚ã„ã„ã­(2023å¹´7æœˆç¾åœ¨ã§ã¯æ²»ã£ã¦ã„ã‚‹ã‹ã‚‚)?
