---
title: "suseã®bootstrap"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["opensuse", "bash", "Linux"]
published: true
published_at: 2022-10-17 19:00 
---

suseã®bootstrapã®æ–¹æ³•ãŒãƒãƒƒãƒˆã§æ¢ã—ã¦ã‚‚è‹±èªã§ã•ãˆã‚ã¾ã‚Šæƒ…å ±ãŒç„¡ã„ã®ã§ã€
ã“ã“ã«æ›¸ãã€‚

dnfã¨zypperã§ã‚„ã‚‹æ–¹æ³•ãŒã‚ã‚Šã€
ã§ãã‚Œã°zypperã®æ–¹ãŒsuseã¨ã®ç›¸æ€§ãŒã‚ˆãã¦ãƒˆãƒ©ãƒ–ãƒ«ãŒç„¡ã„ã ã‚ã†ã€‚

zypperã¯debianã‚„ubuntu, archlinuxã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹äº‹ãŒã§ãã‚‹ã€‚

rhelç³»ã¯fedoraã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹zypperã‚’ä½¿ã†ã‹ã€dnfã‚’ä½¿ãŠã†ã€‚

## ä»®æƒ³ç’°å¢ƒã¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

chrootå…ˆã‚„systemd-nspawnã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã€‚
ã“ã“ã§ã¯systemd-nspawnã§æ›¸ã„ã¦ã„ãã®ã§ã€chrootã®äººã¯ç½®ãæ›ãˆã¦
ç†è§£ã—ã¦ãã ã•ã„ã€‚

### dnfã§ã‚„ã‚‹å ´åˆ

ä¸‹ã®ã‚ˆã†ã«yumã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã€‚
gpgcheck=0ã¨ã™ã‚‹ã®ã¯ã€
gpgkeyãŒopensuseã®å ´åˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«åå‰ãŒ
é•ã†ã®ã§ã€ãã‚Œã«åˆã‚ã›ã¦æ›¸ãã“ã¨ãŒã§ããªã„ã‹ã‚‰ã§ã‚ã‚‹ã€‚
15.4ãªã©ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ±ºã‚æ‰“ã¤ãªã‚‰ã€gpgcheckã‚’ã—ã¦ã‚‚è‰¯ã„ã€‚

```bash:/etc/yum.repos.d/opensuse-leap.repo
[opensuse-leap]
name=OpenSUSE Leap $releasever
baseurl=https://download.opensuse.org/distribution/leap/$releasever/repo/oss/
gpgcheck=0
```

```bash
ARCH=amd64
version=15.4
# repoã«yum.repoã«è¨­å®šã—ãŸãƒ¬ãƒã‚¸ãƒˆãƒªåï¼ˆä¾‹[opensuse-leap]ï¼‰ã‚’ä½¿ã†ã€‚
dnf install --installroot=/var/lib/machines/opensuse --repo=opensuse-leap --releasever=$version rpm-repos-openSUSE-Leap systemd systemd-network bash zypper util-linux
```

### zypperã§ã‚„ã‚‹å ´åˆ

ã¾ãšãƒ›ã‚¹ãƒˆOSå´ã§zypperã«ä½¿ã„ãŸã„OSã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã‚ˆã†ã€‚
ä»Šå›ã¯Opensuse ã®15.4ã‚’ä½¿ã„ãŸã„ã®ã§ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

```bash
zypper ar -f -c http://download.opensuse.org/distribution/leap/15.4/repo/oss opensuse-leap-15.4
zypper --installroot /var/lib/machines/opensuse/ in rpm-repos-openSUSE-Leap systemd systemd-network bash zypper util-linux
```

## ä»®æƒ³ç’°å¢ƒã®èµ·å‹•

chrootã‚„systemd-nspawnã‚’ä½¿ã£ã¦èµ·å‹•ã•ã›ã‚ˆã†ã€‚

## ä»®æƒ³ç’°å¢ƒã«å…¥ã£ãŸå¾Œã®å‡¦ç†

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®š

systemd-nspawnã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯systemdãŒå‹•ãã®ã§ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã€‚

```bash
sudo systemctl start systemd-networkd
sudo systemctl enable systemd-networkd
sudo systemctl start systemd-resolved
sudo systemctl enable systemd-resolved
```

### ãƒ¬ãƒã‚¸ãƒˆãƒªã®è¿½åŠ 

ä»®æƒ³ç’°å¢ƒã«å…¥ã£ãŸã‚‰ä¸‹ã®ã‚ˆã†ã«ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¦ãŠãã€‚

```bash
zypper ar -f -c 'http://download.opensuse.org/distribution/leap/$releasever/repo/oss' repo-oss
zypper ar -f -c 'http://download.opensuse.org/distribution/leap/$releasever/repo/non-oss' repo-non-oss
zypper ar -f -c 'http://download.opensuse.org/update/leap/$releasever/oss' repo-oss-update
zypper ar -f -c 'http://download.opensuse.org/update/leap/$releasever/non-oss' repo-non-oss-update
```

### localeã®è¨­å®š

æœ€å°é™ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã ã¨ãƒ­ã‚±ãƒ¼ãƒ«ãŒå…¥ã£ã¦ã„ãªã„ã®ã§ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŸã‚ã€
ä»®æƒ³ç’°å¢ƒã«å…¥ã£ãŸã‚‰è¨­å®šã—ã¦ãŠãã€‚

```bash
zypper in -y glibc-i18ndata glibc-locale
localectl set-locale LANG=en_US.UTF-8
```
